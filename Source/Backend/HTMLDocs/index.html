<html>
<head>
    <title>
        A CSM-Miner dummy
    </title>
    <link rel="apple-touch-icon" sizes="57x57" href="/images/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/images/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/images/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/images/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/images/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/images/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/images/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/images/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192" href="/images/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="/images/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
    <link rel="manifest" href="/manifest.json">
    <link rel="shortcut icon" href="/favicon.ico">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/images/ms-icon-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <style>
        #projectDrawer {
            -o-transition: .5s;
            -ms-transition: .5s;
            -moz-transition: .5s;
            -webkit-transition: .5s;
            position: fixed;
            top: 0;
            left: 0;
            min-width: 100%;
            min-height: 100%;
            background-color: white;
            z-index: 999;
            width: 100%;
            height: 100%;
        }

        #add-project {
            height: 100%;
            width: 100%;
            position: fixed;
            background-color: transparent;
            z-index: 9999;
        }

        .projectContainer {
            margin: 10px;
            display: grid;
            grid-gap: 20px;
            grid-template-columns: repeat(auto-fill, 150px);
            grid-template-rows: repeat(auto-fill, 150px);
        }
        
        .dummyView {
        	 background-image: url("./images/apple-icon.png");
        	 background-size: cover;
        }

        #app {
            position: relative;
            border-radius: 25px;
            border: 2px solid #73AD21;
            width: 150px;
            height: 150px;
            text-align: center;
            margin: 0;
            background-size: cover;
        }

        #app .centered {
            margin-block-start: 20px;
            margin-top: 20px;
            text-align: center;
            font-size: 70pt;
        }

        #app .bottom {
            position: absolute;
            top: 110px;
            left: 45px;
            z-index: 2;
        }

        #app:hover {
            box-sizing: border-box;
            -moz-box-sizing: border-box;
            -webkit-box-sizing: border-box;
            border: 2px solid orange;
            cursor: pointer;
        }

        iframe {
            min-width: fit-content;
            background: white;
            min-height: fit-content;
            height: 10em;
            padding: 20px;
            position: relative;
            text-align: center;
            -webkit-box-shadow: 0px 0px 50px -1px rgba(0,0,0,0.79);
            -moz-box-shadow: 0px 0px 50px -1px rgba(0,0,0,0.79);
            box-shadow: 0px 0px 50px -1px rgba(0,0,0,0.79);
        }

        .SUBMIT {
            left: 50%;
            bottom: 10px;
            position: absolute;
        }

        .hideMe {
            opacity: 0;
            visibility: hidden;
        }

        #loading {
            position: fixed;
            left: 50%;
            top: 50%;
        }

        #mainContainer {
            position: fixed;
            left: 0%;
            top: 0%;
            height: 100%;
            width: 100%;
        }

        #mainGraph {
            z-index: 5;
            width: 100% height : 100%;
            top: 0;
            left: 0;
        }

        #statusBar {
            opacity: 0.1;
            -o-transition: .5s;
            -ms-transition: .5s;
            -moz-transition: .5s;
            -webkit-transition: .5s;
            position: fixed;
            left: 0;
            bottom: 0;
            z-index: 9;
            background-color: grey;
            min-height: fit-content;
            max-height: fit-content;
            min-width: fit-content;
            max-width: fit-content;
        }

        #statusBar:hover {
            opacity: 1;
        }

        #statusBar:leave {
            opacity: 0.6;
        }

        #views {
            -o-transition: .5s;
            -ms-transition: .5s;
            -moz-transition: .5s;
            -webkit-transition: .5s;
            top: 0;
            background-color: green;
            position: fixed;
            z-index: 9;
            right: 0;
            height: 100%;
        }

        #menuBar {
            border-radius: 0 0 5px 5px;
            -o-transition: .5s;
            -ms-transition: .5s;
            -moz-transition: .5s;
            -webkit-transition: .5s;
            top: 0;
            background-color: green;
            position: fixed;
            z-index: 10;
            left: 3em;
            opacity: 0.1;
            min-height: fit-content;
            max-height: fit-content;
            min-width: fit-content;
            max-width: fit-content;
        }

        #menuBar:hover {
            opacity: 1 !important;
        }

        #menuBar:leave {
			opacity: 0 !important;
        }


        .element {
            margin-left: 5px;
            margin-right: 5px;
            margin-bottom: 15px;
            width: 200px;
            height: 200px;
            background-color: yellow;
        }

        .element:hover {
            box-sizing: border-box;
            -moz-box-sizing: border-box;
            -webkit-box-sizing: border-box;
            border: 2px solid orange;
        }

        .elementUpdate {
            animation: borderUpdate 1s linear 1;
        }

        @keyframes borderUpdate {
            50% {
                border: 3px solid orange;
            }
        }

        .notDone {
            box-sizing: border-box;
            -moz-box-sizing: border-box;
            -webkit-box-sizing: border-box;
            border: 2px solid red !important;
        }

        .scrollable {
            seamless: "seamless";
            overflow: auto;
            -ms-overflow-style: none;
            // IE 10+ scrollbar-width: none;
            // Firefox min-width: fit-content;
            max-width: fit-content;
            background: grey;
            height: 100%;
        }

        .scrollable::-webkit-scrollbar {
	        display: none;
        }

        .bgEdit {
            background-image: url("./images/matrix.png");
        }

        #content {
            width: 100%;
            height: 100%;
            text-align: center;
        }

        canvas {
            width: 100%;
            height: 100%;
        }

        #add-project iframe {
            position: fixed;
            z-index: 999;
            margin: 0 auto !important;
            left: 50% !important;
            top: 50% !important;
            transform: translate(-50%, -50%) !important;
        }
        
        #unfinished{
        	background-size: cover;
        	z-index:99999;
        	width:96px;
        	height:96px;
            transform: translate(30%, 30%) !important;
            background-image: url('load.svg');
        }
        
    </style>
    <!-- Sets the basepath for the library if not in same directory -->
    <script type="text/javascript">
        mxBasePath = './';
    </script>

    <!-- Loads and initializes the library -->
    <script type="text/javascript" src="./mxClient.js"></script>
    <script>
		function hideUpload(){
			var ifm = document.getElementById("add-project");
			ifm.classList.add("hideMe");
		}


		function parentCall(check){
			if(check == "FILE_OK"){
				hideUpload();
				pReq.open("GET","/request/PROJECTS.json");
				pReq.send();
			}else if(check != ""){
				alert(check);
			}
		}
		
		var current;
		
		function getJson(name){
			var rt = null;
			jsonObj.forEach(function(element,index){
                if(element.filename == name){
                	rt = jsonObj[index];
                }
			});
			if ( rt == null )
				return "Error";
			else
				return rt;
		}
		
		function load (e){
            alert("Dummy");
            console.log(e.getAttribute("name"));
            inProject = true;
            current = getJson(e.getAttribute("name"));
            var container = document.getElementById("mainGraph");
            if (!mxClient.isBrowserSupported()){
                mxUtils.error('Browser is not supported!', 200, false);
            }else{
                // Creates the graph inside the given container
                var graph = new mxGraph(container);

                // Enables rubberband selection
                new mxRubberband(graph);

                // Gets the default parent for inserting new cells. This
                // is normally the first child of the root (ie. layer 0).
                var parent = graph.getDefaultParent();

                // Adds cells to the model in a single step
                graph.getModel().beginUpdate();
                try{
                    var v1 = graph.insertVertex(parent, null,'Hello,', 20, 20, 80, 30);
                    var v2 = graph.insertVertex(parent, null,'World!', 200, 150, 80, 30);
                    var e1 = graph.insertEdge(parent, null, '', v1, v2);
                }finally{
                    // Updates the display
                    graph.getModel().endUpdate();
                }
            }
            document.getElementById('projectDrawer').classList.add('hideMe');
		}

		function add(){
			var rm = document.getElementById('add-project');
			rm.classList.remove('hideMe');
		}

		const formType = {
			REQUEST_FORM: 'RQ',
			YES_NO_FORM: 'YN',
			INFO_FORM: 'IF'
		}

		class Form{
			constructor(name, parent){
				this.form = document.createElement('form');
				parent.appendChild(this.form);
				this.form.name = name;
			}

			add(element) {
				this.form.appendChild(element);
			}



			get(){
				return this.form;
			}
		}

		function mkForm(name,type,parent){
			const f = new Form(name,parent);

			switch(type){
				case formType.REQUEST_FORM:
					f.add(document.createElement('label'));
				case formType.YES_NO_FORM:

				case formType.INFO_FORM:

			}
		}

				
			
		var jString = '{{ projects }}';

		var dec = jString.replace(/&quot;/g, '"');
		var jsonObj = JSON.parse(dec);

		function showProjects(){
			var el = document.getElementById('projectAdds');
			var addDiv = document.getElementsByName('addProj')[0];
			jsonObj.forEach(function(element){
                makeElement(element,el,true);
			});

		}

		document.addEventListener('DOMContentLoaded', function() {
            showProjects();
		}, false);
			
		var pReq = new XMLHttpRequest();

        function jsonContains(element, json) {
            json.forEach(function (el) {
                if (element === el) {
                    return true;
                }
            });
            return false;
        }

        function makeElement(el, par, onStart = false) {
            var addDiv = document.getElementsByName('addProj')[0];
            var pDiv = document.createElement("div");
			pDiv.setAttribute("name",el.filename);
			pDiv.id = "app";
			pDiv.style = "background-image: url('" + el.backgroundImgPath +"');"
			var lblName = document.createTextNode(el.name);
			var pVar = document.createElement('p');
			pVar.appendChild(lblName);
			pVar.classList.add('bottom');
			pDiv.appendChild(pVar);
			if(!el.preProcessed){
				var ld = document.createElement('div');
				ld.id = "unfinished";
				pDiv.appendChild(ld);
                pDiv.setAttribute("onClick", "alert('Still processing files.');");
                pDiv.classList.add("notDone");
			}else{
				pDiv.setAttribute("onClick","return load(this);");
            }
            if (!onStart) {
                pDiv.classList.add("elementUpdate");
            }
            // TO-DO : IF HOLDING DOWN, THEN OPTION TO REMOVE
			par.insertBefore(pDiv,addDiv);
        }

        function updateElement(element) {
            element.classList.add("elementUpdate");
        }
        
        var inProject = false;

		function updateProjects(){
			var parent = document.getElementById('projectAdds');
            jsonObj.forEach(function (el) {
                if (!jsonContains(el, JSON.parse(jString.replace(/&quot;/g, '"')))) {
                    parent.removeChild(document.getElementsByName(el.filename)[0]);
                }
            });
            JSON.parse(jString.replace(/&quot;/g, '"')).forEach(function (element) {
                if (!jsonContains(element, jsonObj)) {
                    makeElement(element, parent);
                }
            });
            dec = jString.replace(/&quot;/g, '"');
			jsonObj = JSON.parse(dec);
        }
		
		var myViews = 0;
			
		function loadDone(evt){
			if(pReq.status >= 200 && pReq.status < 300){
				if(inProject){
					var i = JSON.parse(pReq.responseText).viewCount;
					while(i > myViews){
						var v = document.createElement('div');
						v.classList.add("element");
						v.classList.add("dummyView");
						var par = document.getElementById('views');
						par.append(v);
						myViews++;
					}
				}else{
					jString = pReq.responseText;
					if(dec != jString.replace(/&quot;/g, '"')){
						console.log("Change noticed.");
						updateProjects();
					}
				}
			}else{
				console.warn(pReq.statusText,pReq.responseText);
			}
		}
			
		pReq.addEventListener("load", loadDone);
			
		setInterval(function(){
			if(inProject){
				pReq.open("GET","/request/" + current.name + ".json");
				pReq.send();
			}else{
				pReq.open("GET","/request/PROJECTS.json");
				pReq.send();
			}
		},1000);
    </script>
</head>
	<body>
		<div id="projectDrawer" class="scrollable" onLoad="showProjects();"> 
			<div id="add-project" class="hideMe" onclick="return hideUpload();">
				<iframe id="myframe" frameborder="0" src="./uploadForm.html" width="600px" height="800px">Your Browser does not support the iframe tag.</iframe>
			</div>
			<h3 style="text-align:center;">Projects</h3>
			<div class="projectContainer" id="projectAdds" class="scrollable">
				<div onclick="return add();"  id="app" name="addProj">
				<p class="centered">+</p>
				<p class="bottom">Add new</p>
				</div>
			</div>
		</div>
		<div id="mainContainer">
			<div id="mainGraph"></div>
			<div id="views" class="scrollable">
				<!--
					TO-DO : ADD VIEW-LOADING
				-->
			</div>
			<div id="statusBar">
			 Such status info. Much Wow.
			</div>
			<div id="menuBar">
			 Such menuBar. Much Wow.
			</div>
		</div>
	</body>
</html>